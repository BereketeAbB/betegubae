<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ge'ez Manuscript Transcription Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(to right, #2c3e50, #4a6491);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .editor-container {
            display: flex;
            flex-wrap: wrap;
            min-height: 600px;
        }

        .input-section {
            flex: 1;
            min-width: 400px;
            padding: 25px;
            border-right: 1px solid #eaeaea;
        }

        .output-section {
            flex: 1;
            min-width: 400px;
            padding: 25px;
            background-color: #f9f9f9;
        }

        .section-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #2c3e50;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
        }

        .time-inputs {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .time-input {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #4a6491;
            box-shadow: 0 0 0 2px rgba(74, 100, 145, 0.2);
        }

        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .symbols-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f4f8;
            border-radius: 8px;
        }

        .symbols-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .symbol-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .symbol-btn {
            padding: 8px 12px;
            background-color: #4a6491;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .symbol-btn:hover {
            background-color: #3a5479;
            transform: translateY(-2px);
        }

        .special-btn {
            background-color: #e67e22;
        }

        .special-btn:hover {
            background-color: #d35400;
        }

        .instructions {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.5;
        }

        .output-area {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            min-height: 200px;
            margin-bottom: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }

        .actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .primary-btn {
            background-color: #4a6491;
            color: white;
            flex: 2;
        }

        .primary-btn:hover {
            background-color: #3a5479;
        }

        .secondary-btn {
            background-color: #eaeaea;
            color: #333;
            flex: 1;
        }

        .secondary-btn:hover {
            background-color: #ddd;
        }

        .entry-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #eaeaea;
            border-radius: 6px;
        }

        .entry-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eaeaea;
            font-family: monospace;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .entry-item:last-child {
            border-bottom: none;
        }

        .entry-time {
            color: #666;
            font-size: 0.9rem;
        }

        .entry-text {
            flex: 1;
            margin: 0 15px;
        }

        .entry-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            font-size: 1.1rem;
            padding: 5px;
        }

        .icon-btn:hover {
            color: #4a6491;
        }

        /* Preview styling */
        .preview-container {
            margin-top: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .preview-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .preview-content {
            font-family: 'Noto Sans Ethiopic', sans-serif;
            font-size: 24px;
            line-height: 1.6;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            min-height: 150px;
        }

        .preview-char {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 2px;
            vertical-align: bottom;
        }

        .preview-base {
            font-size: 24px;
            min-height: 30px;
            display: flex;
            align-items: flex-end;
        }

        .preview-symbol {
            font-size: 12px;
            line-height: 1;
            margin-bottom: 2px;
            font-family: 'Zemayared', 'Noto Sans Ethiopic', sans-serif;
        }

        .preview-black {
            color: black;
        }

        .preview-red {
            color: red;
        }

        .preview-empty {
            color: #999;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eaeaea;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .editor-container {
                flex-direction: column;
            }

            .input-section {
                border-right: none;
                border-bottom: 1px solid #eaeaea;
            }
        }

        /* Zemayared font */
        @font-face {
            font-family: 'Zemayared';
            src: url('Zemayared1.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>Ge'ez Chant Transcription Editor</h1>
            <p class="subtitle">Create transcriptions with special symbols in brackets and angle brackets</p>
        </header>

        <div class="editor-container">
            <div class="input-section">
                <h2 class="section-title">Transcription Input</h2>

                <div class="time-inputs">
                    <div class="time-input">
                        <label for="start-time">Start Time</label>
                        <input type="number" id="start-time" step="0.01" value="1.14">
                    </div>
                    <div class="time-input">
                        <label for="end-time">End Time</label>
                        <input type="number" id="end-time" step="0.01" value="1.18">
                    </div>
                </div>

                <label for="transcription-text">Transcription Text</label>
                <textarea id="transcription-text" placeholder="Enter Ge'ez text with symbols in brackets [...] and angle brackets ‚Äπ...‚Ä∫">·ä≠·â°[·â°·â†][,]‚Äπ·à†·à®‚Ä∫·à≠</textarea>

                <div class="symbols-panel">
                    <h3 class="symbols-title">Special Symbols</h3>
                    <div class="symbol-buttons">
                        <button class="symbol-btn" data-symbol="[~]">[~]</button>
                        <button class="symbol-btn" data-symbol="[;]">[;]</button>
                        <button class="symbol-btn" data-symbol="[:]">[:]</button>
                        <button class="symbol-btn" data-symbol="[,]">[,]</button>
                        <button class="symbol-btn" data-symbol="[·à†·à®]">[·à†·à®]</button>
                        <button class="symbol-btn" data-symbol="[·ä•·åç]">[·ä•·åç]</button>
                        <button class="symbol-btn" data-symbol="[·à∞·àã]">[·à∞·àã]</button>
                        <button class="symbol-btn" data-symbol="[·àà·ä™]">[·àà·ä™]</button>
                        <button class="symbol-btn" data-symbol="[·â†·ä•]">[·â†·ä•]</button>
                        <button class="symbol-btn" data-symbol="[·çà]">[·çà]</button>
                        <button class="symbol-btn" data-symbol="[·âÄ]">[·âÄ]</button>
                        <button class="symbol-btn" data-symbol="[·å†·å†]">[·å†·å†]</button>
                        <button class="symbol-btn" data-symbol="[·ã¥]">[·ã¥]</button>
                        <button class="symbol-btn" data-symbol="[·à∞·ä†]">[·à∞·ä†]</button>
                        <button class="symbol-btn" data-symbol="[·ä†·ã≠]">[·ä†·ã≠]</button>
                        <button class="symbol-btn" data-symbol="[·â°·â†]">[·â°·â†]</button>
                        <button class="symbol-btn" data-symbol="[·çî·à≠]">[·çî·à≠]</button>
                        <button class="symbol-btn" data-symbol="[·äê·äí]">[·äê·äí]</button>
                        <button class="symbol-btn special-btn" data-symbol="‚Äπ·à†·à®‚Ä∫">‚Äπ·à†·à®‚Ä∫</button>
                        <button class="symbol-btn special-btn" data-symbol="‚Äπ·âÄ·àà‚Ä∫">‚Äπ·âÄ·àà‚Ä∫</button>
                        <button class="symbol-btn special-btn" data-symbol="‚Äπ·äê·ä™‚Ä∫">‚Äπ·äê·ä™‚Ä∫</button>
                    </div>
                    <p class="instructions">
                        Click on symbols to insert them at the cursor position. Use brackets [...] for variant readings and angle brackets ‚Äπ...‚Ä∫ for editorial corrections.
                    </p>
                </div>

                <div class="actions">
                    <button id="add-entry" class="primary-btn">Add Transcription Entry</button>
                    <button id="clear-text" class="secondary-btn">Clear Text</button>
                </div>

                <div class="preview-container">
                    <h3 class="preview-title">Rendered Preview (Zemayared Font for Symbols)</h3>
                    <div class="preview-content" id="preview-content">
                        {/* Preview will be generated here */}
                    </div>
                </div>
            </div>

            <div class="output-section">
                <h2 class="section-title">Output Preview</h2>

                <div class="output-area" id="output-preview">
                    {/* Output will be generated here */}
                </div>

                <div class="actions">
                    <button id="export-json" class="primary-btn">Export as JSON</button>
                    <button id="copy-output" class="secondary-btn">Copy to Clipboard</button>
                </div>

                <h3 class="section-title">Entries List</h3>
                <div class="entry-list" id="entries-list">
                    {/* Entries will be listed here */}
                </div>
            </div>
        </div>

        <footer>
            <p>Ge'ez Manuscript Transcription Editor | Designed for scholarly transcription work</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample data
            const sampleData = [
                { time: 1.14, end: 1.18, text: "·ä≠·â°[·â°·â†][,]‚Äπ·à†·à®‚Ä∫·à≠" },
                { time: 1.19, end: 1.23, text: "·àû·â±[·â†·ä•][·å†·å†]‚Äπ·âÄ·àà‚Ä∫" },
                { time: 1.24, end: 1.28, text: "·àà[,][~]·åª·ãµ[.][,]·âÖ[·çà][·âÄ]‚Äπ·äê·ä™‚Ä∫" },
                { time: 1.29, end: 1.34, text: "·â†·âÖ[~]·ãµ·àò[,] ·ä•[V]·åç·ãö[.][.]·â•·àî·à≠·ç¢" },
                { time: 1.35, end: 1.40, text: "·ç¢" },
                { time: 1.41, end: 1.46, text: "·ä•[~]·åç[][V]·ãö·ä¶[·çî·à≠][·ã¥]" },
                { time: 1.47, end: 1.52, text: "·ä†[,][.]·äê[·äê·äí][·ç¥][·çà·å†][·ãµ·äï]" },
                { time: 1.53, end: 1.58, text: "·åà·â•·à≠[:]·ä®[·å†·å†,]·ç¢" },
                { time: 1.59, end: 1.64, text: "·ç¢" },
                { time: 1.65, end: 1.70, text: "·åà[~][~][~]·â•·à≠[^][V]·ä®[·à≥·äï][·çà·å†][·ãµ·äï]" },
                { time: 1.71, end: 1.76, text: "·ãà[-]·àç·ã∞[V] ·ä†·àò[,]·âµ[:]·ä®[·àµ]·ç¢" },
            ];

            let entries = [...sampleData];

            // DOM elements
            const startTimeInput = document.getElementById('start-time');
            const endTimeInput = document.getElementById('end-time');
            const transcriptionText = document.getElementById('transcription-text');
            const addEntryBtn = document.getElementById('add-entry');
            const clearTextBtn = document.getElementById('clear-text');
            const exportJsonBtn = document.getElementById('export-json');
            const copyOutputBtn = document.getElementById('copy-output');
            const outputPreview = document.getElementById('output-preview');
            const entriesList = document.getElementById('entries-list');
            const symbolButtons = document.querySelectorAll('.symbol-btn');
            const previewContent = document.getElementById('preview-content');

            // Initialize the editor with sample data
            updateOutputPreview();
            updateEntriesList();
            updatePreview();

            // Add symbol buttons functionality
            symbolButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const symbol = this.getAttribute('data-symbol');
                    insertAtCursor(transcriptionText, symbol);
                    updatePreview();
                });
            });

            // Update preview when text changes
            transcriptionText.addEventListener('input', updatePreview);

            // Function to insert text at cursor position
            function insertAtCursor(textarea, text) {
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const value = textarea.value;

                textarea.value = value.substring(0, start) + text + value.substring(end);
                textarea.selectionStart = textarea.selectionEnd = start + text.length;
                textarea.focus();
            }

            // Function to parse text into character-symbol pairs
            function parseTextWithSymbols(text) {
                const result = [];
                let currentChar = '';
                let symbols = [];

                let i = 0;
                while (i < text.length) {
                    const char = text[i];

                    if (char === '[') {
                        // Found black symbol
                        const symbolEnd = text.indexOf(']', i);
                        if (symbolEnd !== -1) {
                            const symbolContent = text.substring(i + 1, symbolEnd);
                            symbols.push({
                                content: symbolContent,
                                type: 'black'
                            });
                            i = symbolEnd + 1;
                            continue;
                        }
                    } else if (char === '‚Äπ') {
                        // Found red symbol
                        const symbolEnd = text.indexOf('‚Ä∫', i);
                        if (symbolEnd !== -1) {
                            const symbolContent = text.substring(i + 1, symbolEnd);
                            symbols.push({
                                content: symbolContent,
                                type: 'red'
                            });
                            i = symbolEnd + 1;
                            continue;
                        }
                    } else if (char === '<') {
                        // Found red symbol (alternative)
                        const symbolEnd = text.indexOf('>', i);
                        if (symbolEnd !== -1) {
                            const symbolContent = text.substring(i + 1, symbolEnd);
                            symbols.push({
                                content: symbolContent,
                                type: 'red'
                            });
                            i = symbolEnd + 1;
                            continue;
                        }
                    } else {
                        // Regular character
                        if (currentChar) {
                            result.push({
                                char: currentChar,
                                symbols: [...symbols]
                            });
                            symbols = [];
                        }
                        currentChar = char;
                    }
                    i++;
                }

                // Add last character
                if (currentChar || symbols.length > 0) {
                    result.push({
                        char: currentChar,
                        symbols: [...symbols]
                    });
                }

                return result;
            }

            // Update preview function
            function updatePreview() {
                const text = transcriptionText.value;
                previewContent.innerHTML = '';

                if (!text.trim()) {
                    previewContent.textContent = 'Preview will appear here...';
                    return;
                }

                const parsed = parseTextWithSymbols(text);

                parsed.forEach((item, index) => {
                    const charContainer = document.createElement('span');
                    charContainer.classList.add('preview-char');

                    // Add symbols (reversed so last symbol appears closest to text)
                    const reversedSymbols = [...item.symbols].reverse();

                    reversedSymbols.forEach((symbol, symbolIndex) => {
                        const symbolSpan = document.createElement('span');
                        symbolSpan.classList.add('preview-symbol');

                        if (symbol.content === "") {
                            symbolSpan.classList.add('preview-empty');
                            symbolSpan.textContent = '‚Ä¢';
                        } else {
                            symbolSpan.classList.add(`preview-${symbol.type}`);
                            symbolSpan.textContent = symbol.content;
                        }

                        charContainer.appendChild(symbolSpan);
                    });

                    // Add base character
                    const baseChar = document.createElement('span');
                    baseChar.classList.add('preview-base');
                    baseChar.textContent = item.char;
                    charContainer.appendChild(baseChar);

                    previewContent.appendChild(charContainer);
                });
            }

            // Add entry button functionality
            addEntryBtn.addEventListener('click', function() {
                const startTime = parseFloat(startTimeInput.value);
                const endTime = parseFloat(endTimeInput.value);
                const text = transcriptionText.value.trim();

                if (isNaN(startTime) || isNaN(endTime) || !text) {
                    alert('Please enter valid time values and text');
                    return;
                }

                entries.push({
                    time: startTime,
                    end: endTime,
                    text: text
                });

                updateOutputPreview();
                updateEntriesList();

                // Clear the text area for next entry
                transcriptionText.value = '';
                updatePreview();

                // Auto-increment times for convenience
                startTimeInput.value = (endTime + 0.01).toFixed(2);
                endTimeInput.value = (parseFloat(startTimeInput.value) + 0.04).toFixed(2);
            });

            // Clear text button functionality
            clearTextBtn.addEventListener('click', function() {
                transcriptionText.value = '';
                transcriptionText.focus();
                updatePreview();
            });

            // Export JSON button functionality
            exportJsonBtn.addEventListener('click', function() {
                const dataStr = JSON.stringify(entries, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

                const exportFileDefaultName = 'geez_transcription.json';

                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            });

            // Copy output button functionality
            copyOutputBtn.addEventListener('click', function() {
                const textToCopy = outputPreview.textContent;
                navigator.clipboard.writeText(textToCopy).then(function() {
                    // Show a temporary success message
                    const originalText = copyOutputBtn.textContent;
                    copyOutputBtn.textContent = 'Copied!';
                    setTimeout(() => {
                        copyOutputBtn.textContent = originalText;
                    }, 2000);
                });
            });

            // Update output preview
            function updateOutputPreview() {
                let outputText = 'data: [\n';

                entries.forEach((entry, index) => {
                    outputText += `              { time: ${entry.time}, end: ${entry.end}, text: "${entry.text}" }`;
                    if (index < entries.length - 1) {
                        outputText += ',';
                    }
                    outputText += '\n';
                });

                outputText += '            ]';
                outputPreview.textContent = outputText;
            }

            // Update entries list
            function updateEntriesList() {
                entriesList.innerHTML = '';

                entries.forEach((entry, index) => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'entry-item';

                    entryElement.innerHTML = `
                        <div class="entry-time">${entry.time}-${entry.end}</div>
                        <div class="entry-text">${entry.text}</div>
                        <div class="entry-actions">
                            <button class="icon-btn edit-btn" data-index="${index}">‚úèÔ∏è</button>
                            <button class="icon-btn delete-btn" data-index="${index}">üóëÔ∏è</button>
                        </div>
                    `;

                    entriesList.appendChild(entryElement);
                });

                // Add event listeners for edit and delete buttons
                document.querySelectorAll('.edit-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        editEntry(index);
                    });
                });

                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        deleteEntry(index);
                    });
                });
            }

            // Edit entry
            function editEntry(index) {
                const entry = entries[index];

                startTimeInput.value = entry.time;
                endTimeInput.value = entry.end;
                transcriptionText.value = entry.text;
                updatePreview();

                // Remove the entry from the list
                entries.splice(index, 1);

                updateOutputPreview();
                updateEntriesList();
            }

            // Delete entry
            function deleteEntry(index) {
                if (confirm('Are you sure you want to delete this entry?')) {
                    entries.splice(index, 1);
                    updateOutputPreview();
                    updateEntriesList();
                }
            }
        });
    </script>
</body>
</html>